<!DOCTYPE html>
<html>
<head>
    <title>Test Master Playlist Refresh</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-button {
            padding: 10px 20px;
            margin: 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .test-button:hover { background: #c82333; }
        .test-button.success { background: #28a745; }
        .test-button.success:hover { background: #218838; }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #28a745;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }
        .highlight { background: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ Master Playlist Refresh Tool</h1>

        <div class="highlight">
            <strong>DB ê¸°ë°˜ Master.m3u8 ì¬ìƒì„±</strong><br>
            í˜„ì¬ DBì˜ DubTrack ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ master.m3u8 íŒŒì¼ì„ ì¬ìƒì„±í•˜ì—¬
            ëª¨ë“  ë”ë¹™ëœ ì–¸ì–´ê°€ ì •í™•íˆ ë°˜ì˜ë˜ë„ë¡ í•©ë‹ˆë‹¤.
        </div>

        <h2>ğŸ¯ ë¬¸ì œ í•´ê²°:</h2>
        <ul>
            <li>âŒ ê¸°ì¡´: master.m3u8ì— ë§ˆì§€ë§‰ ì–¸ì–´ë§Œ ì €ì¥ë˜ëŠ” ë¬¸ì œ</li>
            <li>âœ… í•´ê²°: DBì˜ ëª¨ë“  ready ìƒíƒœ DubTrackì„ master.m3u8ì— ë°˜ì˜</li>
            <li>âœ… ì‹¤ì‹œê°„: ë”ë¹™ ì™„ë£Œì‹œë§ˆë‹¤ ìë™ìœ¼ë¡œ master.m3u8 ì—…ë°ì´íŠ¸</li>
        </ul>

        <h2>ğŸ§ª í…ŒìŠ¤íŠ¸ ì„¹ì…˜ë“¤:</h2>

        <div style="margin: 20px 0;">
            <h3>Section 3 (í…ŒìŠ¤íŠ¸ ë°ì´í„°)</h3>
            <button class="test-button" onclick="refreshMaster(3)">Section 3 Master ì¬ìƒì„±</button>
            <button class="test-button success" onclick="checkMaster(3)">í˜„ì¬ Master í™•ì¸</button>
        </div>

        <div style="margin: 20px 0;">
            <h3>Section 1</h3>
            <button class="test-button" onclick="refreshMaster(1)">Section 1 Master ì¬ìƒì„±</button>
            <button class="test-button success" onclick="checkMaster(1)">í˜„ì¬ Master í™•ì¸</button>
        </div>

        <div style="margin: 20px 0;">
            <h3>Section 2</h3>
            <button class="test-button" onclick="refreshMaster(2)">Section 2 Master ì¬ìƒì„±</button>
            <button class="test-button success" onclick="checkMaster(2)">í˜„ì¬ Master í™•ì¸</button>
        </div>

        <div id="result"></div>

        <h2>ğŸ“Š ê¸°ëŒ€ ê²°ê³¼:</h2>
        <ul>
            <li>Section 3: 4ê°œ ì–¸ì–´ (ja, zh, en, fr) - ëª¨ë‘ í‘œì‹œë˜ì–´ì•¼ í•¨</li>
            <li>ê° ì–¸ì–´ë³„ EXT-X-MEDIA ë¼ì¸ì´ ëª¨ë‘ í¬í•¨</li>
            <li>status='ready'ì¸ DubTrackë§Œ ë°˜ì˜</li>
            <li>ì¼ë³¸ì–´ ë˜ëŠ” í•œêµ­ì–´ê°€ DEFAULT=YESë¡œ ì„¤ì •</li>
        </ul>

        <div class="highlight">
            <strong>ğŸ’¡ êµ¬í˜„ëœ ê¸°ëŠ¥:</strong><br>
            â€¢ DBì—ì„œ ready ìƒíƒœ DubTrack ì¡°íšŒ<br>
            â€¢ ëª¨ë“  ì–¸ì–´ë¥¼ master.m3u8ì— ë°˜ì˜<br>
            â€¢ S3ì— ì—…ë¡œë“œí•˜ì—¬ ì¦‰ì‹œ ì ìš©<br>
            â€¢ API ì—”ë“œí¬ì¸íŠ¸: POST /api/refresh-master
        </div>
    </div>

    <script>
        async function refreshMaster(sectionId) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `ğŸ”„ Section ${sectionId} master.m3u8 ì¬ìƒì„± ì¤‘...`;

            try {
                const response = await fetch('/api/refresh-master', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ sectionId })
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.className = 'result';
                    resultDiv.innerHTML = `âœ… Section ${sectionId} master.m3u8 ì¬ìƒì„± ì™„ë£Œ!\n\n` +
                        `Master URL: ${data.masterUrl}\n\n` +
                        `ì‘ë‹µ ë°ì´í„°:\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `âŒ ì˜¤ë¥˜ ë°œìƒ:\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`;
            }
        }

        async function checkMaster(sectionId) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `ğŸ” Section ${sectionId} master.m3u8 ë‚´ìš© í™•ì¸ ì¤‘...`;

            try {
                const masterUrl = `https://storage.lingoost.com/assets/curriculumsection/${sectionId}/master.m3u8`;
                const response = await fetch(masterUrl);

                if (response.ok) {
                    const content = await response.text();
                    const lines = content.split('\n');
                    const audioLines = lines.filter(line => line.includes('EXT-X-MEDIA:TYPE=AUDIO'));

                    resultDiv.className = 'result';
                    resultDiv.innerHTML = `ğŸ“„ Section ${sectionId} Master.m3u8 ë‚´ìš©:\n\n` +
                        `ì „ì²´ ë‚´ìš©:\n${content}\n\n` +
                        `ì˜¤ë””ì˜¤ íŠ¸ë™ ìˆ˜: ${audioLines.length}\n` +
                        `ì˜¤ë””ì˜¤ íŠ¸ë™ë“¤:\n${audioLines.join('\n')}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `âŒ Master íŒŒì¼ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${response.status}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }
    </script>
</body>
</html>