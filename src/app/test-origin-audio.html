<!DOCTYPE html>
<html>
<head>
    <title>Origin Audio HLS Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-button {
            padding: 10px 20px;
            margin: 10px;
            background: #17a2b8;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .test-button:hover { background: #138496; }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #17a2b8;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .highlight { background: #e7f5ff; padding: 15px; border-left: 4px solid #339af0; margin: 15px 0; }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ ì›ë³¸ ì˜¤ë””ì˜¤ HLS ì²˜ë¦¬ í…ŒìŠ¤íŠ¸</h1>

        <div class="highlight">
            <strong>ìƒˆë¡œìš´ ê¸°ëŠ¥: ì›ë³¸ ì˜¤ë””ì˜¤ë„ HLS ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ!</strong><br>
            ì–¸ì–´ ì½”ë“œ <code>origin</code>ìœ¼ë¡œ ì›ë³¸ ì˜¤ë””ì˜¤ë¥¼ ê´€ë¦¬í•˜ê³ ,<br>
            ë‹¤ë¥¸ ë”ë¹™ ì–¸ì–´ë“¤ê³¼ ë™ì¼í•˜ê²Œ HLS ì„¸ê·¸ë¨¼íŠ¸ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
        </div>

        <h2>ğŸ”§ êµ¬í˜„ëœ ê¸°ëŠ¥:</h2>
        <ul>
            <li>âœ… ì›ë³¸ ì˜¤ë””ì˜¤ë¥¼ <code>origin</code> ì–¸ì–´ ì½”ë“œë¡œ DubTrackì— ì €ì¥</li>
            <li>âœ… ì›ë³¸ ë¹„ë””ì˜¤ì—ì„œ ì˜¤ë””ì˜¤ ì¶”ì¶œ (ffmpeg -vn)</li>
            <li>âœ… ì›ë³¸ ì˜¤ë””ì˜¤ë„ HLS ì„¸ê·¸ë¨¼íŠ¸ë¡œ ë³€í™˜</li>
            <li>âœ… ì–¸ì–´ ì„ íƒì—ì„œ "ì›ë³¸"ì´ í•­ìƒ ì²« ë²ˆì§¸ ì˜µì…˜</li>
            <li>âœ… ê¸°ë³¸ ì„ íƒ ì–¸ì–´ë¥¼ ì›ë³¸ìœ¼ë¡œ ì„¤ì •</li>
            <li>âœ… ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€ (ì´ë¯¸ ì¡´ì¬í•˜ë©´ ìŠ¤í‚µ)</li>
        </ul>

        <h2>ğŸ“ ì˜ˆìƒ Master.m3u8 í˜•ì‹:</h2>
        <div class="code-block">
#EXTM3U
#EXT-X-VERSION:7
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="aud",NAME="ì›ë³¸",LANGUAGE="origin",AUTOSELECT=YES,DEFAULT=YES,URI="audio/origin/audio.m3u8"
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="aud",NAME="ja",LANGUAGE="ja",AUTOSELECT=YES,DEFAULT=NO,URI="audio/ja/audio.m3u8"
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="aud",NAME="zh",LANGUAGE="zh",AUTOSELECT=YES,DEFAULT=NO,URI="audio/zh/audio.m3u8"
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="aud",NAME="en",LANGUAGE="en",AUTOSELECT=YES,DEFAULT=NO,URI="audio/en/audio.m3u8"
#EXT-X-STREAM-INF:BANDWIDTH=2500000,CODECS="avc1.4d401f,mp4a.40.2",RESOLUTION=1920x1080,AUDIO="aud"
video/video.m3u8
        </div>

        <h2>ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•:</h2>

        <button class="test-button" onclick="checkOriginTrack()">ì›ë³¸ íŠ¸ë™ í™•ì¸</button>
        <button class="test-button" onclick="checkMasterPlaylist()">Master Playlist í™•ì¸</button>
        <button class="test-button" onclick="checkOriginAudio()">ì›ë³¸ ì˜¤ë””ì˜¤ HLS í™•ì¸</button>

        <div id="result"></div>

        <h2>ğŸ’¡ êµ¬í˜„ ë¡œì§:</h2>

        <h3>1. DubTrack ìƒì„± (dubbing.ts)</h3>
        <div class="code-block">
// ì›ë³¸ ì˜¤ë””ì˜¤ íŠ¸ë™ í™•ì¸/ìƒì„±
const originTrack = await prisma.dubTrack.findUnique({
    where: { videoId_lang: { videoId: video.id, lang: "origin" } }
});

if (!originTrack) {
    await prisma.dubTrack.create({
        data: {
            videoId: video.id,
            lang: "origin",
            status: "ready",
            url: originalVideoUrl
        }
    });
}
        </div>

        <h3>2. HLS ë³€í™˜ (dubbing.ts)</h3>
        <div class="code-block">
// ì›ë³¸ + ë”ë¹™ ì–¸ì–´ ëª¨ë‘ ì²˜ë¦¬
const allLanguagesToProcess = ["origin", ...body.targetLanguages];

for (const lang of allLanguagesToProcess) {
    if (lang === "origin") {
        // ë¹„ë””ì˜¤ì—ì„œ ì˜¤ë””ì˜¤ ì¶”ì¶œ
        await execa("ffmpeg", [
            "-i", videoUrl,
            "-vn",  // ë¹„ë””ì˜¤ ì œê±°
            "-acodec", "pcm_s16le",
            "-ar", "48000",
            "-ac", "2",
            "origin.wav"
        ]);
    }
    // HLS ì„¸ê·¸ë¨¼íŠ¸ ìƒì„±...
}
        </div>

        <h3>3. í”„ë¡ íŠ¸ì—”ë“œ í‘œì‹œ (hls-player-modal.tsx)</h3>
        <div class="code-block">
// ì–¸ì–´ ë§µì— ì›ë³¸ ì¶”ê°€
const langNameMap = {
    origin: "ì›ë³¸",
    ko: "í•œêµ­ì–´",
    ja: "ì¼ë³¸ì–´",
    // ...
};

// ì›ë³¸ì„ ì²« ë²ˆì§¸ë¡œ ì •ë ¬
tracks.sort((a, b) => {
    if (a.language === "origin") return -1;
    if (b.language === "origin") return 1;
    return 0;
});
        </div>
    </div>

    <script>
        async function checkOriginTrack() {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result';
            resultDiv.innerHTML = `ğŸ” ì›ë³¸ íŠ¸ë™ í™•ì¸ ì¤‘...\n\n` +
                `DBì—ì„œ lang='origin'ì¸ DubTrack ë ˆì½”ë“œë¥¼ í™•ì¸í•©ë‹ˆë‹¤.\n` +
                `ì´ íŠ¸ë™ì€ ì›ë³¸ ë¹„ë””ì˜¤ì˜ ì˜¤ë””ì˜¤ë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤.`;
        }

        async function checkMasterPlaylist() {
            const resultDiv = document.getElementById('result');
            try {
                const response = await fetch('https://storage.lingoost.com/assets/curriculumsection/3/master.m3u8');
                const content = await response.text();
                const hasOrigin = content.includes('origin');

                resultDiv.className = 'result';
                resultDiv.innerHTML = `ğŸ“„ Master Playlist ë‚´ìš©:\n\n${content}\n\n` +
                    `ì›ë³¸ íŠ¸ë™ í¬í•¨ ì—¬ë¶€: ${hasOrigin ? 'âœ… í¬í•¨ë¨' : 'âŒ ì—†ìŒ'}`;
            } catch (error) {
                resultDiv.className = 'result';
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }

        async function checkOriginAudio() {
            const resultDiv = document.getElementById('result');
            const originUrl = 'https://storage.lingoost.com/assets/curriculumsection/3/audio/origin/audio.m3u8';

            try {
                const response = await fetch(originUrl);
                if (response.ok) {
                    const content = await response.text();
                    resultDiv.className = 'result';
                    resultDiv.innerHTML = `âœ… ì›ë³¸ ì˜¤ë””ì˜¤ HLS ì¡´ì¬!\n\nURL: ${originUrl}\n\në‚´ìš©:\n${content}`;
                } else {
                    resultDiv.className = 'result';
                    resultDiv.innerHTML = `âŒ ì›ë³¸ ì˜¤ë””ì˜¤ HLSê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\nURL: ${originUrl}\nStatus: ${response.status}`;
                }
            } catch (error) {
                resultDiv.className = 'result';
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }
    </script>
</body>
</html>